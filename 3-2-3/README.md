# 3.2.3 基于统计K近邻滤波

## K近邻滤波原理

在使用了距离阈值滤波、孤立点滤波后，只能针对明显的离群点进行粗略的滤波，并不能保证完全滤除离群点。为了更进一步滤除离群点，使用基于统计的K近邻滤波算法对点云进行滤波。K近邻滤波算法对每个点的邻域进行一个统计分析，修剪掉那些不符合一定标准的点。我们的离群点滤除方法基于在点云中对点到临近点的距离分布的计算。对每个点，计算它到所有邻近点的平均距离。

假设得到的结果是一个高斯分布，其形状由均值和标准差决定，平均距离在标准范围（由全局离散平均值和方差定义）之外的点，可被定义为离群点并从数据集中去除。

## K近邻滤波算法

基于统计的K近邻滤波方法计算点云中每个点与其K近邻之间的平均距离，其基本思路为：对每个点，统计距离它最近的K个点，记该点为Pi，最近的K个点为计算该点Pi与K近邻点之间的距离：d1,s, d2,s, d3,s,···, dK,s，则该点的K近邻点平均距离为：

dMeans = (∑(i=1 to K) di,s) / K

点云全局平均距离为：

dist = (∑(i=1 to n) dMeani) / n

均为差为：

σ = √[(∑(i=1 to n)(dist - dMeani)²) / n]

其中n为点云中点的个数。由于所得点云的K近邻点平均距离符合高斯分布的3σ法则，离群点必然不满足高斯分布的3σ法则。设定(dist - 3 * σ, dist + 3 * σ)为标准区间，对点云中K近邻点平均距离不符合该标准区间的点进行滤除。

## 滤波实现细节

由于激光三维测量传感器获取点云有序，为了保持点云的有序性，只需标记滤波点为NAN，并将其坐标值设置为标记值(0,0,0)。后续插运算中将标记为NAN点的标记值(0,0,0)改变为插补值。

该算法通过统计分析有效去除了点云中的离群点，提高了数据质量，为后续的燃烧室点云分离奠定了基础。